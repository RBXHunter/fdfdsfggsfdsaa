-- Скрипт полёта для главного загрузчика
-- Хостится на raw GitHub: https://raw.githubusercontent.com/username/repository/main/3skill_sonic.lua

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local task = task

local player = Players.LocalPlayer
if not player then
    player = Players:GetPropertyChangedSignal("LocalPlayer"):Wait() and Players.LocalPlayer
end

local FLY_ANIM_IDS = {
    ["13376962659"] = true,
    ["13362587853"] = true,
}
local FLY_DELAY = 0.3
local FLY_DURATION = 1.5
local FLY_SPEED = 150

local isFlying = false
local flyEndTime = 0
local humanoid, rootPart, animator

local connections = {}

local function isEnabled()
    return _G.isScriptEnabled ~= false
end

local function setupCharacter(char)
    if not isEnabled() then return end
    humanoid = char:WaitForChild("Humanoid", 5)
    rootPart = char:WaitForChild("HumanoidRootPart", 5)
    if not humanoid or not rootPart then
        warn("Ошибка пошел нахуй ебень)
        return
    end

    animator = humanoid:FindFirstChildOfClass("Animator")
    if not animator then
        animator = Instance.new("Animator")
        animator.Parent = humanoid
    end

    local animationConnection = animator.AnimationPlayed:Connect(function(track)
        if not isEnabled() then return end
        local animId = track.Animation.AnimationId:gsub("rbxassetid://", "")
        if FLY_ANIM_IDS[animId] then
            if isFlying then return end
            task.delay(FLY_DELAY, function()
                if not isEnabled() or isFlying then return end
                isFlying = true
                flyEndTime = tick() + FLY_DURATION
            end)
        end
    end)

    table.insert(connections, animationConnection)
end

if player.Character then
    task.spawn(setupCharacter, player.Character)
end
local characterConnection = player.CharacterAdded:Connect(setupCharacter)
table.insert(connections, characterConnection)

local renderConnection = RunService.RenderStepped:Connect(function()
    if not isEnabled() or not isFlying or not humanoid or not rootPart then return end
    if tick() > flyEndTime then
        isFlying = false
        if rootPart then
            rootPart.Velocity = Vector3.new(0, 0, 0)
        end
        return
    end

    local cam = workspace.CurrentCamera
    if not cam then return end
    local look = cam.CFrame.LookVector
    rootPart.Velocity = look * FLY_SPEED
end)
table.insert(connections, renderConnection)

local function cleanup()
    for _, connection in pairs(connections) do
        if connection then
            pcall(function() connection:Disconnect() end)
        end
    end
    connections = {}
    isFlying = false
    if rootPart then
        rootPart.Velocity = Vector3.new(0, 0, 0)
    end
end

game:BindToClose(cleanup)

task.spawn(function()
    while true do
        task.wait(0.5)
        if not isEnabled() then
            cleanup()
            break
        end
    end
end)
